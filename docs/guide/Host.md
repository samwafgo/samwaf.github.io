# 网站配置
  
## 1 部署架构：
请依据下面的架构方式布局SamWaf防火墙

### 1.1 部署在同台服务器（常见）
::: important
重要:部署在同台服务器会存在端口：80、443已经占用得情况 ，请在本机或者网站业务不繁忙得时候操作。[修改查看常见问题](../faq/readme.md#_1-端口80-被占用情况)  

:::


```mermaid
---
title: 部署在同一台服务器
---
flowchart TB
    A[客户浏览器]
	B(SamWaf)
	C(Web服务器)
	A --> B  
	B --> A
	subgraph 服务器1
    B --> C
    C --> B
    end
  
```


### 1.2 部署在不同服务器
此部署方式适合服务器资源丰富将SamWaf单独部署，域名解析到SamWaf所在服务器即可。
后面接入各各网站服务器，只暴露SamWaf所在服务器

```mermaid
---
title: 部署在不同服务器
---
flowchart TB
    A[客户浏览器]
	B(SamWaf)
	C(Web服务器)
	A --> B  
	subgraph 服务器1
    B 
    end  
	B --> C
	subgraph 服务器2 
    C
    end
	C --> B
	B --> A 
  
```
## 2 新增可被防火墙保护的网站：

关键配置，配置一次即可随时使用。

### 2.1 新增网站
 ![新增一个受到SamWaf防火墙保护的网站](/images/add_host.png)
- 网站：
    - 正常填写网站域名即可,注意 https，http前缀,/ 等后缀都不要加
	
	例如：www.baidu.com，pan.baidu.com
	
- 端口：
    - 输入需要防护的网站端口 
	http是80 https 是 443 （如果已经安装了宝塔，Nginx，IIS等 需要手工改动端口成非80，或者非443端口）[修改查看常见问题](../faq/readme.md#_1-端口80-被占用情况) 
- 加密证书：
    1.如果是https需要选择加密证书，80端口不需要
	首次需要点击“添加新证书”，新增证书。
	
	 ![新增SSL证书](/images/add_ssl.png)
	```
	通常文件名：*.key 内容格式如下：-----BEGIN RSA PRIVATE KEY----- ... 全选复制填写进来
	```
	- 证书串
	```
	通常文件名：*.crt 内容格式如下：-----BEGIN CERTIFICATE----- ... 全选复制填写进来
	```
	
	2. 从证书夹选择对应证书

     ![选择证书](/images/add_host_select_ssl.png)
	
- 启动状态：
	自动启动：添加后正常提供服务；手工启动，添加后不会占用端口，不提供服务。

- 来源严格端口：
    来源严格端口 默认是开启，如果关闭后 适合外层nginx,cdn情况
	
- 后端系统类型、后端应用类型：
     非必要，可以选择和实际一样，也可以保持默认（后期可能针对后端接入不同做适配处理）
 
- 后端IP：
     如SamWaf同网站在同一台服务器 填写127.0.0.1 如果是不同服务器请填写实际IP	
- 后端端口：
     情况1，在SamWaf和网站在同一台服务器，那么端口需要写成81等其他端口  情况2：如果不在同一台服务器，那么此处可以原来端口 
	
## 3 负载均衡：
负载均衡支持：权重轮询(WRR),IP Hash
 
- 权重轮询(WRR)：根据后端服务器的权重，按依次将请求分发给不同的服务器。权值越高的服务器被轮询到的次数（概率）越高。

- IP Hash：根据请求的源 IP 地址，使用散列键（Hash Key）从散列表找出对应的服务器,使得相同IP每次访问的服务器是固定的。


### 3.1 负载均衡配置
点击被防护的网站启动“负载均衡”。

![负载均衡列表](/images/loadbalanceindex.png)。

### 3.2 添加后端负载

![负载配置](/images/loadbalance_edit.png)。

- IP： 填入后端可接入的IP
- 端口： 填入后端可接入的端口
- 权重：填入权重，针对 权重轮询(WRR)模式，可以增加客户访问改服务器的几率。


## 4 网站密码访问
自v1.3.9-beta.11 已支持网站密码访问, 添加或者编辑网站最后一个选项卡，网站密码访问。
网站密码访问默认关闭，可以自行打开。

### 4.1 网站密码访问列表


![网站密码访问列表](/images/password_visit.png)，

在此查看、添加、编辑、或者删除。

效果如下：

![网站密码访问效果如下](/images/password_visit2.png)，

## 5.其他配置

### 5.1 记录日志时排除URL

一行一个日志url

### 5.2 访问超时设置

自v1.3.9-beta.13 支持自定义设置,默认60s,单位秒，如果填写0则是不限制

![访问超时设置](/images/response_timeout.png)

## 6.导出导入
### 6.1 导出
导出可以导出所有主机信息,如果是首次可以作为初始化的导入模板来源。

### 6.2 导入
导入主机信息可以有两个选择：
- 导入新增主机编码(适用全新数据)
- 导入保留主机编码(适用老数据数据)
![导入参数](/images/import_host.png)

PS:SamWaf是轻量级的，对于老数据迁移我们推荐方式是，关闭服务，直接拷贝所有目录下的数据到新服务器即可。

## 7.同时绑定多个域名

可以支持多个域名一行一个。支持泛域名

![同时绑定多个域名](/images/bind_more_domain.png)